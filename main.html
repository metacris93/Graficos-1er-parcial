<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Proyecto de Graficos por Computadora 1</title>
  </head>
  <script src="js/jquery-2.2.3.min.js" type="text/javascript"></script>
  <script src="js/three.min.js" type="text/javascript"></script>
  <script src="js/controls/OrbitControls.js" type="text/javascript"></script>
  <script src='js/libs/dat.gui.min.js'></script>
  <script src='js/libs/stats.min.js'></script>
  <script src="js/objects/ShadowMesh.js"></script>
  <script type="text/javascript" src="variables.js"></script>
  <script type="text/javascript" src="funciones.js"></script>
  <style>
      body{
          /* set margin to 0 and overflow to hidden, to go fullscreen */
          margin: 0;
          overflow: hidden;
      }
      canvas { width: 100%; height: 100% }
  </style>
  <body>
      <div id="render"></div>
      <script type="text/javascript">
      /*
      * En esta funcion se crea el plano, enviando como parametros el alto, ancho y la imagen.
      * En caso de que la ruta de la imagen este vacio, se va crear un plano con un color predeterminado
      */
      function crear_plano(ancho , alto , imagen){
          if(imagen.length != 0){//si no se envia la ruta de la imagen

          }else{
            var geometria = new THREE.PlaneBufferGeometry(ancho, alto,1,1);
            var material = new THREE.MeshBasicMaterial({color: 'rgb(0,130,0)'});
            plano = new THREE.Mesh( geometria, material );
            plano.receiveShadow = true;
          }
      }

      function renderizar(){
        requestAnimationFrame( renderizar );
        renderer.render(scene, camara);
      }

      $(function (){
          renderer.setSize(window.innerWidth, window.innerHeight);
          renderer.setClearColor( 'rgb(186,228,218)' );

          control_orbital = new THREE.OrbitControls(camara , renderer.domElement);
          control_orbital.addEventListener( 'change', renderizar );
          //renderer.shadowMapEnabled = true;
          crear_plano(15, 15,"");
          plano.rotation.x=-0.5*Math.PI;
          plano.position.x = 0;
          plano.position.y = -1 ;
          plano.position.z = 0;
          scene.add( plano );
          // se ubica la camara en el centro de la escena
          camara.position.x = -5;//-30
          camara.position.y = 5;
          camara.position.z = 0;
          camara.lookAt(scene.position);

          //iluminacion
          sunLight.position.set( -30, 50, - 2 );
          sunLight.lookAt( scene.position );
  				scene.add( sunLight );
          lightPosition4D.x = sunLight.position.x;
  				lightPosition4D.y = sunLight.position.y;
  				lightPosition4D.z = sunLight.position.z;
  				lightPosition4D.w = 0.001; // must be slightly greater than 0, due to 0 causing matrixInverse errors

          arrowDirection.subVectors( scene.position, sunLight.position ).normalize();

  				arrowPosition1.copy( sunLight.position );
  				arrowHelper1 = new THREE.ArrowHelper( arrowDirection, arrowPosition1, 0.9, 0xffff00, 0.25, 0.08 );
  				scene.add( arrowHelper1 );
  				arrowHelper1.visible=false;

          // Iluminacion
  				var lightSphereGeometry = new THREE.SphereGeometry( 0.09 );
  				var lightSphereMaterial = new THREE.MeshBasicMaterial( { color: 'rgb(255,255,255)' } );
  				lightSphere = new THREE.Mesh( lightSphereGeometry, lightSphereMaterial );
  				scene.add( lightSphere );
  				lightSphere.visible = false;

  				var lightHolderGeometry = new THREE.CylinderGeometry( 0.05, 0.05, 0.13 );
  				var lightHolderMaterial = new THREE.MeshBasicMaterial( { color: 'rgb(75,75,75)' } );
  				lightHolder = new THREE.Mesh( lightHolderGeometry, lightHolderMaterial );
  				scene.add( lightHolder );
  				lightHolder.visible = false;
  				// Fin de iluminacion

  				agregar_cubo();

  				agregar_cilindro();

  				agregar_toroide();

  				agregar_esfera();

  				agregar_piramide();

          animacion();

          $('#render').append(renderer.domElement);
          renderer.render(scene , camara);
          /*var controlador = new Controlador();
          gui_widget = new dat.GUI();
          gui_widget.addColor(controlador , 'Color');*/


      });

      window.addEventListener( 'resize', function () {

      camara.aspect = window.innerWidth / window.innerHeight;
      camara.updateProjectionMatrix();

      renderer.setSize( window.innerWidth, window.innerHeight );

      }, false );
      </script>
  </body>
</html>
